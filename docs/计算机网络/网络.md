# 网络协议与抓包

## 抓包工具

#### telent

telnet 是一种基于 TCP 的传统命令行远程控制协议。telnet 使用非加密的通道，因此不太安全。现在主要用于链接一些旧设备。

> archlinux:
如果只使用 telnet 联接到别的机器，只需要安装 netkit-telnet 即可：
```bash
# pacman -S inetutils
```

#### Wireshark 

dumpcap 需要 root 权限才能使用的,以普通用户打开 Wireshark ，Wireshark 当然没有权限使用 dumpcap 进行截取封包。

其实可以使用

```sudo wireshark```

sudo 的方式用 root 打开 Wireshark，但是这样做显然是不安全的，也不是很方便的，因为得到的封包数据也属于 root 用户，而 sudo 打开 Wireshark 也会提醒你谨慎使用 root 权限使用 Wireshark，并且给你一篇文档说明。

文档里说明可以使用用户组功能使用 Wireshark，接下来是具体方法：

- 1、添加用户组，我以 wireshark 为例

```sudo groupadd wireshark```

- 2、将 dumpcap 更改为 wireshark 用户组

```sudo chgrp wireshark /usr/bin/dumpcap```

- 3、让 wireshark 用户组有 root 权限使用 dumpcap

```sudo chmod 4755 /usr/bin/dumpcap```

(PS:4754 Wireshark还是会提示没有权限 )

- 4、将自己加入 wireshark 用户组，我的用户是 gqzcl，你添加需要更改这个。

```sudo gpasswd -a gqzcl wireshark```

这样就完成，你可以使用自己的用户打开 Wireshark ，并且有权限进行操作了。


#### 实例

```telnet www.taohui.pub 80```

```GET /wp-content/plugins/Pure-Highlightjs_1.0/assets/pure-highlight.css?ver=0.1.0 HTTP/1.1 ```

```Host: www.taohui.pub ```

最后加上回车，即 CRLF(见规则)

## ABNF(扩充巴克斯-瑙尔范式)

* 空白字符: 用来分隔定义中的各个元素
	* method SP(空格) request-target SP HTTP-version CRLF(换行)
* 选择 / ：表示多个规则都是可供选择的规则
	* start-line = request-line / status-line
* 值范围 %c##-##:
	* OCTAL = "0"/"1"/"2"/"3"/"4"/"5"/"6"/"7" 与 OCTAL = %X90-37 等价
* 序列组合(): 将规则组合起来，视为单个元素
* 不定量重复 m*n:
	* *元素表示另个或者多个元素: ```*(header-field CRLF)```
	* 1\*元素表示一个或者更多元素，2\*4元素表示两个至四个元素
* 可选序列[]:
	* [message-body]

## ABNF(扩充巴克斯-瑙尔范式) 核心规则

规则	   |形式定义						|意义
--------|-------------------------------|--------------------
ALPHA	|%x41-5A / %x61-7A				|大小写ASCII字母（A-Z,a-z）
DIGIT	|%x30-39						|数字（0-9）
HEXDIG	|DIGIT/“A”/“B”/“C”/“D”/“E”/“F”	|十六进制数(0-9,A-F,a-f)
DQUOTE	|%x22							|双引号
SP		|%x20							|空格
HTAB	|%x09							|横向制表符
WSP		|SP/HTAB						|空格或横向制表符
LWSP	|*(WSP/CRLF WSP)				|直线空白
VCHAR	|%x21-7E						|可见字符
CHAR	|%x01-7F						|任何7-位US-ASCII字符，不包括NUL
OCTET	|%x00-FF						|8位数据
CTL		|%x00-1F/%x7F					|空值字符
CR		|%x0D							|回车 （mac）
LF		|%x0A							|换行 （Linux）
CRLF	|CR LF							|标准换行（windows）
BIT		|“0”/“1”						|二进制数字

## 基于ABNF语义定义的HTTP消息格式

**HTTP-message** = start-line *( header-filed CRLF ) CRLF [ message-body ]

* start-line = request-line / status-line
	* request-line = method SP resquest-status SP HTTP-version CRLF
	* status-line = HTTP-version SP status-code SP reason-phrase CRL
* header-filed = field-name ":" OWS field-value OWS
	* OWS=*(SP / HTAB)
	* field-name = token
	* field-value = \*(field-content / obs-fold )
* message-body = *OCTET

